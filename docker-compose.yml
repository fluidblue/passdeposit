version: "3.8"

services:
    passdeposit:
        image: node:14
        working_dir: /passdeposit
        command: sh -c "npm install --global passdeposit && passdeposit --config /etc/passdeposit/config.json"
        volumes:
            - passdeposit-config:/etc/passdeposit

    mongodb:
        image: mongo:3.6.9
        restart: always
        environment:
            MONGO_INITDB_ROOT_USERNAME: admin
            MONGO_INITDB_ROOT_PASSWORD_FILE: /run/secrets/passdeposit_mongodb_admin_password
        ports:
            - 127.0.0.1:27017:27017
        volumes:
            - mongodb-data:/data/db
            - mongodb-config:/data/configdb
        secrets:
            - passdeposit_mongodb_admin_password
            - passdeposit_mongodb_passdeposit_password

    mongodb-backup:
        image: debian:11

volumes:
    passdeposit-config:
    mongodb-data:
    mongodb-config:
    mongodb-backup:

secrets:
    passdeposit_mongodb_admin_password:
        external: true
    passdeposit_mongodb_passdeposit_password:
        external: true
